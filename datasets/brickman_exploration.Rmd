---
title: "Brickman"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ncdf4)
library(sf)
library(stars)
```

```{r}
path <- "/mnt/ecocast/coredata/brickman/nc/2075/RCP85/"
if (dir.exists(path)) setwd(path)

X <- ncdf4::nc_open("dSST_dSSS_F_R85_2066-2085.nc")
```

```{r help}
print(X)
```

```{r eval = FALSE}
x <- dplyr::tibble(lon = as.vector(ncdf4::ncvar_get(X, "nav_lon")),
                   lat = as.vector(ncdf4::ncvar_get(X, "nav_lat")),
                   bathy = as.vector(ncdf4::ncvar_get(X, "Bathy_depth")),
                   sst_ann = as.vector(ncdf4::ncvar_get(X, "SST_ann"))) |>
  sf::st_as_sf(coords = c("lon", "lat"), crs = 4326)

r <- x |> stars::st_rasterize(nx = X$dim$c$len, ny = X$dim$r$len,
                              options = "ALL_TOUCHED=TRUE")
r

par(mfrow = c(2,1))
plot(r["bathy"], axes = TRUE)
plot(r["sst_ann"], axes = TRUE)
```

```{r cleanup}
ncdf4::nc_close(X)
```
